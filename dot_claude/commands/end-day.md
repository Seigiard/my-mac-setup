---
name: end-day
description: |
  Завершает день: создаёт synthesis и handoff для следующей сессии. Используй вечером для подведения итогов или когда заканчиваешь работу.

  <example>
  <user>/end-day</user>
  <assistant>Вижу 3 чекпоинта и 4 сессии. Черновик synthesis: "Продуктивный день..."</assistant>
  <user>Норм, так и запиши</user>
  <assistant>Из открытых задач: X, Y. Что важнее на завтра?</assistant>
  </example>

  <example>
  <user>/end-day --date 2026-01-11</user>
  <assistant>Завершаю 11 января. Вижу чекпоинты...</assistant>
  <commentary>Явное указание даты для завершения прошлого дня</commentary>
  </example>

  <example>
  <context>После полуночи</context>
  <user>/end-day</user>
  <assistant>Сейчас 01:30. Завершаем вчера (11 января) или сегодня (12 января)?</assistant>
  </example>

  <example>
  <user>/end-day вчера</user>
  <assistant>Завершаю вчера (12 января). Вижу чекпоинты...</assistant>
  <commentary>Простое относительное выражение — сразу вычисляем и продолжаем</commentary>
  </example>

  <example>
  <user>/end-day прошлый вторник</user>
  <assistant>Прошлый вторник — это 7 января, верно?</assistant>
  <user>Да</user>
  <assistant>Завершаю 7 января...</assistant>
  <commentary>День недели — подтверждаем с конкретной датой</commentary>
  </example>
disable-model-invocation: true
---

Завершить день и создать handoff для следующей сессии.

Путь к vault: `/Users/seigiard/Library/CloudStorage/Dropbox/Knowledge Base`

## Использование

```
/end-day                     # Автодетект даты
/end-day --date 2026-01-12   # Явное указание даты (ISO)
/end-day вчера               # Вчерашний день
/end-day позавчера           # Позавчера
/end-day три дня назад       # Относительная дата
/end-day прошлый вторник     # День недели
```

---

## Что делает команда

### 0. Определить текущую дату и время

- Выполнить: `date +"%Y-%m-%d %H:%M"`
- Сохранить результат для использования в следующих шагах

### 1. Распарсить аргумент даты

**Если аргумент — дата ISO (YYYY-MM-DD или --date):**
- Использовать как есть

**Если аргумент — естественный язык:**

| Выражение | Расчёт |
|-----------|--------|
| `вчера` | `date -v-1d +"%Y-%m-%d"` |
| `позавчера` | `date -v-2d +"%Y-%m-%d"` |
| `N дней назад` | `date -v-Nd +"%Y-%m-%d"` |
| `прошлый [день недели]` | Найти ближайший прошедший день |
| `в [день недели]` | Найти ближайший прошедший день |

**Для дней недели:**
1. Получить текущий день: `date +"%u"` (1=пн, 7=вс)
2. Вычислить смещение до нужного дня
3. Рассчитать дату: `date -v-Xd +"%Y-%m-%d"`

**При неуверенности — подтвердить:**
- Показать расчёт: "Прошлый вторник — это [дата], верно?"
- Дождаться подтверждения
- НЕ спрашивать "какая дата?" — всегда предлагать конкретную

**Если аргумента нет:**
- Перейти к шагу 2 (автодетект)

### 2. Определить дату закрытия

**Если дата получена из шага 1:**
- Использовать её

**Если после полуночи (00:00 - 05:00) по времени из шага 0:**
- Спросить: "Сейчас [полученное время]. Завершаем вчера ([дата-1]) или сегодня ([дата])?"

**Иначе:**
- Использовать дату из шага 0

### 3. Прочитать дневную заметку

- Путь: `Calendar/YYYY-MM-DD.md`
- Прочитать `## Checkpoints`
- Прочитать `## Today's Focus`
- Прочитать `## Mood Check`

### 4. Проверить повторный запуск

- Если `## Handoff` уже содержит заполненные `### Open Threads` или `### Context for Tomorrow`:
  - Спросить: "Вижу handoff уже создан. Обновить его или оставить как есть?"
  - Если "оставить" — завершить команду
  - Если "обновить" — продолжить, перезаписать handoff

### 5. Получить Claude сессии

- Запустить: `~/.claude/hooks/daily-summary.py YYYY-MM-DD --json`
- Получить все сессии за день:
  - Тип (Implementation, Research, Discussion)
  - Количество сообщений, tool calls
  - Файлы созданные/изменённые
  - Темы пользователя
  - Длительность
  - Проект

**Группировка:**

- По проектам/задачам
- Если что-то непонятно — спросить (но не надоедать)

### 6. Записать в `## Claude Sessions`

**Что включать:**

- Значимые сессии (связанные с глобальными задачами)
- Группировать по проектам

**Что НЕ включать:**

- Мелкие сессии ("создай компонент", "исправь опечатку")
- Если сессия часть более крупной работы — объединить

**Формат:**

```markdown
## Claude Sessions

### [[Проект]]

- Реализация фичи X (~2ч, 150 сообщений)
- Рефакторинг модуля Y (~30м)

### Другое

- Исследование библиотеки Z (~20м)
```

### 7. Обработать отсутствие данных

**Если нет чекпоинтов за день:**

- Создать handoff из Claude сессий
- Предложить дополнить: "За день не было чекпоинтов. Хочешь добавить что-то о том как прошёл день?"

**Если нет Claude сессий (выходной):**

- Спросить: "Сегодня не было рабочих сессий. Расскажи как прошёл день?"
- Записать ответ в Synthesis

### 8. Создать Synthesis (Day's End)

**Процесс:**

1. Claude генерирует черновик на основе:
   - Checkpoints
   - Claude Sessions
   - Mood Check (утренний контекст)
   - Today's Focus (что планировалось)
2. Показать черновик
3. Спросить: "Что добавить или изменить?"
4. Записать финальную версию

**Формат:**

```markdown
## Day's End

- **Synthesis**: [Краткое резюме дня: что сделано, как себя чувствовал, ключевые моменты]
```

### 9. Создать Handoff

**Open Threads:**

1. Собрать незакрытые задачи из:
   - Today's Focus (не выполненные)
   - Claude Sessions (next steps из сессий)
   - Checkpoints (упомянутые планы)
2. Спросить: "Из открытых задач: X, Y, Z — что самое важное?"
3. Записать приоритизированный список

**Context for Tomorrow:**

- Для Claude И для человека
- Личный контекст: как закончился день, настроение, энергия
- Технический контекст: где остановились, что нужно помнить

**Формат:**

```markdown
## Handoff

### Open Threads

1. [Приоритет 1 — самое важное]
2. [Приоритет 2]
3. [Остальное]

### Context for Tomorrow

[1-3 предложения: личный + технический контекст для следующей сессии]
```

### 10. Завершить воодушевляюще

**Отметить успехи:**

- Что удалось сделать
- Прогресс по сравнению с планом

**Пожелать хорошего отдыха:**

- Тёплое, поддерживающее завершение
- Без формальностей

---

## Примеры

### Обычный день

```
Claude: Вижу за сегодня:
        - 3 чекпоинта
        - 4 Claude сессии по проекту Intuition
        - Закрыт PR с авторизацией

        Черновик Synthesis:
        "Продуктивный день. Закрыл авторизацию, начал работу над новой фичей.
         К вечеру немного устал, но доволен результатом."

        Что добавить или изменить?

User: Норм, так и запиши

Claude: Из открытых задач остались:
        - Тесты для API
        - Ревью от Пети
        - Начать дизайн dashboard

        Что самое важное на завтра?

User: Тесты и ревью, dashboard подождёт

Claude: Записал!

        Сегодня отличный день — закрыл авторизацию и продвинулся по фиче.
        Отдыхай, завтра разберёмся с тестами.
```

### Выходной день

```
Claude: Сегодня не было рабочих сессий. Расскажи как прошёл день?

User: Отдыхал, гулял с семьёй

Claude: Отлично! Записываю в Synthesis.

        Open threads с прошлого раза:
        - Тесты для API
        - Ревью от Пети

        Оставляем на следующий рабочий день?

User: Да

Claude: Готово! Хорошего вечера и отдыхай дальше.
```

### После тяжёлого дня

```
Claude: Вижу в чекпоинте было "сложный день, застрял на проблеме".

        Черновик Synthesis:
        "Непростой день. Долго бился с проблемой в API, не удалось решить.
         Устал, нужен перерыв."

        Что добавить?

User: Да, так и есть

Claude: Из open threads — хочешь оставить проблему с API или взять что-то другое завтра?

User: Возьму что-то другое, к API вернусь позже

Claude: Записал. Бывают такие дни — главное не застревать.
        Отдохни хорошенько, завтра будет лучше.
```

---

## Что НЕ делает команда

- ❌ НЕ обновляет внешние transcript файлы
- ❌ НЕ создаёт ссылки на архивы
- ❌ НЕ считает статистику сессий в деталях

---

## Заметки

- Всё записывается в одну дневную заметку
- Handoff ищется следующим `/start-day`
- Формат времени: 24h
- Язык: русский
- Стиль завершения: тёплый, поддерживающий
